# Self-Supervised Learning for Anomaly Detection in Underwater Acoustics

## Overview

This project focuses on leveraging self-supervised learning techniques for anomaly detection in underwater acoustic data. It utilizes the SSAMBA (Self-Supervised Audio Mamba) model as a core component to learn robust audio representations, which are then applied to identify anomalous sound events in recordings from the Ocean Networks Canada (ONC) dataset.

The primary goal is to develop and evaluate methods for detecting unusual underwater sounds that may indicate equipment malfunction, unique biological events, or other significant occurrences that deviate from normal ambient noise.

This repository is a personalized fork and significant modification of the original [SSAMBA project](https://github.com/SiavashShams/ssamba) (see also their paper: [SSAMBA: Self-Supervised Audio Representation Learning with Mamba State Space Model](https://arxiv.org/abs/2405.11831)). While the core SSAMBA architecture is used, this project includes custom data handling, experiment scripts, and analysis tools tailored for the ONC dataset and the specific task of anomaly detection.

## Repository Structure

The repository is organized as follows:

*   `src/`: Contains the main source code.
    *   `ssamba/`: The core Python package for this project, including dataset handling (`dataset.py`), model definitions (within `models/`), training and evaluation logic (`traintest.py`, `traintest_mask.py`), and various utilities (`utilities/`).
    *   `run_supervised.py`: Script for running supervised training/evaluation.
    *   `run_amba_spectrogram.py`: Script for running self-supervised pre-training or fine-tuning experiments with the SSAMBA model on spectrograms.
*   `scripts/`: Contains utility and experiment execution scripts.
    *   Data preparation: `create_test_dataset.py`
    *   Analysis: `analyze_labels.py`, `analyze_val_set.py`
    *   Local experiment runners: `run_supervised.sh`, `run_amba_spectrogram.sh`, etc.
*   `notebooks/`: Jupyter notebooks for data exploration, results analysis, and experimentation.
*   `data/`: (Gitignored) Intended for storing local test datasets generated by `scripts/create_test_dataset.py`.
*   `logs/`: (Gitignored) Default directory for log files generated during experiments.
*   `eval/`: Scripts and potentially notebooks related to model evaluation.
*   `tests/`: Unit tests for the project.
*   `exp/`: (Gitignored) Default directory where experiment outputs (models, results, configs) are saved.
*   `drac/`: (Only in `drac` branch) Contains DRAC-specific job submission scripts and configurations.

## Setup & Installation

### Dependencies

*   Python 3.8+
*   PyTorch (see `requirements.txt` for version, compatible with CUDA if available)
*   Other Python packages are listed in `requirements.txt`.

### Installation Steps

1.  **Clone the repository:**
    ```bash
    git clone https://github.com/Spiffical/selfsupervision_anomalies_onc.git
    cd selfsupervision_anomalies_onc
    ```

2.  **Set up a Python environment:**
    It is highly recommended to use a virtual environment (e.g., `conda` or `venv`).

    *Using conda:*
    ```bash
    conda create -n ssamba_env python=3.9  # Or your preferred Python version
    conda activate ssamba_env
    ```

    *Using venv:*
    ```bash
    python -m venv .venv
    source .venv/bin/activate  # On Windows: .venv\Scripts\activate
    ```

3.  **Install Python packages:**
    ```bash
    pip install -r requirements.txt
    ```

4.  **Install the project package:**
    This step makes the `ssamba` module importable in your environment.
    ```bash
    pip install .
    ```

## Data

The primary dataset used for this project is from Ocean Networks Canada (ONC) and is expected to reside on the DRAC (Digital Research Alliance of Canada) cluster at:
`/lustre03/project/6003287/shared/ssamba_data/`

This directory should contain the HDF5 files with pre-computed spectrograms and labels.

For local development and testing, a script is provided to create a smaller subset of the data:
*   `scripts/create_test_dataset.py`
This script will generate a `testing_dataset.h5` (or similar) file. By default, you should modify it to save this file into the `data/` directory at the root of the project. The `data/` directory is gitignored.

## Usage

### Running Experiments Locally

The main scripts for running experiments are `src/run_supervised.py` and `src/run_amba_spectrogram.py`. These scripts accept various command-line arguments to configure the dataset, model, training parameters, etc.

Example shell scripts are provided in the `scripts/` directory to demonstrate how to run these Python scripts:
*   `scripts/run_supervised.sh`
*   `scripts/run_amba_spectrogram.sh`
*   `scripts/run_amba_finetune.sh`

Examine these shell scripts and modify them as needed (e.g., update paths, hyperparameters). You can execute them directly:
```bash
bash scripts/run_supervised.sh
```

### Running on DRAC Cluster

For users with access to the DRAC cluster, DRAC-specific scripts for job submission are available in the `drac` branch of this repository within the `drac/` directory. This includes job submission scripts (e.g., `drac/scripts/submit_jobs.py`) and a DRAC-specific requirements file (`drac/requirements_drac.txt`). Please refer to the `README_DRAC.md` file in the `drac` branch for detailed instructions.

### Jupyter Notebooks

Exploratory data analysis, model evaluation, and experimental results can be found in or performed using the Jupyter notebooks in the `notebooks/` directory.

## License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.

## Acknowledgements

*   This work builds upon the original [SSAMBA: Self-Supervised Audio Representation Learning with Mamba State Space Model](https://github.com/SiavashShams/ssamba) project and its accompanying [paper](https://arxiv.org/abs/2405.11831).
*   The underlying Mamba architecture is based on the work presented in [Mamba: Linear-Time Sequence Modeling with Selective State Spaces](https://arxiv.org/abs/2312.00752).
*   Dataset provided by [Ocean Networks Canada](https://www.oceannetworks.ca/).

---
*(README template, further details can be added as needed)*
